<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hitster Web - Versi贸n Todo en Uno</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* --- ESTILOS CSS INTEGRADOS --- */
        :root { --bg: #121212; --card: #1e1e1e; --green: #1db954; --text: #fff; --red: #e91e63; }
        body { margin: 0; font-family: sans-serif; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .screen { width: 100%; height: 100%; display: flex; flex-direction: column; }
        .hidden { display: none !important; }
        
        /* Start Screen */
        #start-screen { justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .logo { font-size: 3rem; color: var(--green); font-weight: bold; margin-bottom: 20px; }
        .btn { background: var(--green); border: none; padding: 15px 40px; font-size: 1.5rem; border-radius: 50px; cursor: pointer; font-weight: bold; transition: transform 0.1s; }
        .btn:active { transform: scale(0.95); }
        .btn:disabled { background: #555; cursor: not-allowed; opacity: 0.7; }
        
        /* Game Screen */
        .header { padding: 10px 20px; background: #000; display: flex; justify-content: space-between; font-weight: bold; font-size: 1.2rem; }
        #timeline-container { flex: 1; overflow-y: auto; padding: 20px; background: #181818; display: flex; flex-direction: column; align-items: center; }
        #timeline-list { width: 100%; max-width: 500px; min-height: 100px; padding-bottom: 50px; }
        
        /* Cards */
        .card { background: var(--card); padding: 15px; margin-bottom: 10px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; box-shadow: 0 4px 6px rgba(0,0,0,0.3); touch-action: none; }
        .card.playing { border: 2px solid var(--green); background: #2a2a2a; animation: pulse 1.5s infinite; }
        .card.correct { border-color: var(--green); background: rgba(29, 185, 84, 0.2); }
        .card.wrong { border-color: var(--red); background: rgba(233, 30, 99, 0.2); }
        .card-info { flex: 1; text-align: left; }
        .card-title { font-weight: bold; font-size: 1.1rem; margin-bottom: 4px; }
        .card-artist { color: #aaa; font-size: 0.9rem; }
        .card-year { font-weight: bold; background: #000; padding: 5px 10px; border-radius: 5px; color: var(--green); margin-left: 10px; }
        .hidden-year { color: transparent; text-shadow: 0 0 8px #fff; }

        /* Controls */
        #current-card-zone { background: #000; padding: 20px; border-top: 1px solid #333; text-align: center; z-index: 100; }
        #hand-list { min-height: 80px; max-width: 500px; margin: 0 auto 15px auto; }
        .controls { display: flex; gap: 10px; max-width: 500px; margin: 0 auto; }
        .controls button { flex: 1; padding: 15px; border: none; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer; }
        #btn-replay { background: #333; color: white; }
        #btn-check { background: var(--green); color: black; }

        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 200; }
        .modal-content { background: #222; padding: 40px; border-radius: 15px; text-align: center; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(29, 185, 84, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
        #youtube-wrapper { position: absolute; opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

    <div id="start-screen" class="screen">
        <div class="logo"> HITSTER WEB</div>
        <p>Ordena las canciones cronol贸gicamente.</p>
        <p id="loading-msg" style="color: yellow;">Cargando motor de audio...</p>
        <button id="btn-start" onclick="initGame()" class="btn" disabled>ESPERA...</button>
    </div>

    <div id="game-screen" class="screen hidden">
        <div class="header">
            <div>わ <span id="lives">3</span></div>
            <div> <span id="points">0</span></div>
        </div>

        <div id="timeline-container">
            <div id="timeline-list"></div>
        </div>

        <div id="current-card-zone">
            <p id="instruction">Arrastra la carta arriba:</p>
            <div id="hand-list"></div>
            <div class="controls">
                <button id="btn-replay" onclick="replayAudio()"><i class="fa-solid fa-rotate-right"></i></button>
                <button id="btn-check" onclick="checkAnswer()">CONFIRMAR</button>
            </div>
        </div>
    </div>

    <div id="youtube-wrapper"><div id="player"></div></div>

    <div id="game-over-modal" class="modal hidden">
        <div class="modal-content">
            <h2 style="color:var(--red)">隆Juego Terminado!</h2>
            <p>Puntuaci贸n Final: <span id="final-score" style="font-size:2rem; font-weight:bold; color:white">0</span></p>
            <button onclick="location.reload()" class="btn">Jugar de nuevo</button>
        </div>
    </div>

    <script>
        // --- 1. BASE DE DATOS (PEGADA DIRECTAMENTE) ---
        const dbSongs = [
            { "id": "fJ9rUzIMcZQ", "title": "Bohemian Rhapsody", "artist": "Queen", "year": 1975 },
            { "id": "9jK-NcRmVcw", "title": "The Final Countdown", "artist": "Europe", "year": 1986 },
            { "id": "kffacxfA7G4", "title": "Baby", "artist": "Justin Bieber", "year": 2010 },
            { "id": "7zp1TbLFPp8", "title": "Aserej茅", "artist": "Las Ketchup", "year": 2002 },
            { "id": "tIvpam7O6ps", "title": "Soldadito Marinero", "artist": "Fito & Fitipaldis", "year": 2003 },
            { "id": "Xk0wdDTTPA0", "title": "Coraz贸n Part铆o", "artist": "Alejandro Sanz", "year": 1997 },
            { "id": "p7bfOZek9t4", "title": "Zapatillas", "artist": "El Canto del Loco", "year": 2005 },
            { "id": "kJQP7kiw5Fk", "title": "Despacito", "artist": "Luis Fonsi", "year": 2017 },
            { "id": "nuCA_6XzIew", "title": "La Bachata", "artist": "Manuel Turizo", "year": 2022 },
            { "id": "WMqZnJ3n9eM", "title": "Caminando por la vida", "artist": "Melendi", "year": 2005 },
            { "id": "xGCLoBSlE1E", "title": "Bailando", "artist": "Enrique Iglesias", "year": 2014 },
            { "id": "6ylDDs3mdJE", "title": "La Flaca", "artist": "Jarabe de Palo", "year": 1996 },
            { "id": "LxiSL_iE8sM", "title": "Entre dos tierras", "artist": "H茅roes del Silencio", "year": 1990 },
            { "id": "i0jZJtE1Khw", "title": "Ave Mar铆a", "artist": "David Bisbal", "year": 2002 },
            { "id": "nfKfJ9abK2c", "title": "Fiesta Pagana", "artist": "M盲go de Oz", "year": 2000, "offset": 10 },
            { "id": "My2FRPA3Gf8", "title": "Wrecking Ball", "artist": "Miley Cyrus", "year": 2013 },
            { "id": "hkuHRloPyeQ", "title": "Nochentera", "artist": "Vicco", "year": 2023 },
            { "id": "B9_R4-bE-QA", "title": "Devu茅lveme a mi chica", "artist": "Hombres G", "year": 1985 },
            { "id": "sTSphzJALhY", "title": "A qui茅n le importa", "artist": "Alaska y Dinarama", "year": 1986 },
            { "id": "Ysl489e2gS0", "title": "Como Camar贸n", "artist": "Estopa", "year": 1999 }
            // ... Puedes pegar aqu铆 el resto de las 300 canciones ...
        ];

        // --- 2. VARIABLES GLOBALES ---
        let player;
        let allSongs = [];
        let timeline = [];
        let currentSong = null;
        let lives = 3;
        let points = 0;
        let timelineSortable, handSortable;

        // --- 3. INICIALIZACIN DE YOUTUBE ---
        // Se llama autom谩ticamente cuando la API carga
        function onYouTubeIframeAPIReady() {
            console.log("YouTube API Ready");
            player = new YT.Player('player', {
                height: '1', width: '1',
                playerVars: { 'playsinline': 1, 'controls': 0, 'disablekb': 1 },
                events: {
                    'onReady': () => {
                        // Habilitamos el bot贸n solo cuando YouTube est谩 listo
                        const btn = document.getElementById('btn-start');
                        btn.disabled = false;
                        btn.innerText = "JUGAR AHORA";
                        document.getElementById('loading-msg').style.display = 'none';
                    }
                }
            });
        }

        // --- 4. LGICA DEL JUEGO ---
        function initGame() {
            if(!window.Sortable) { alert("Error: No se ha cargado SortableJS. Revisa tu conexi贸n a internet."); return; }
            
            // Copiar canciones
            allSongs = [...dbSongs];
            
            // UI Switch
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            // Init Drag & Drop
            const timelineEl = document.getElementById('timeline-list');
            const handEl = document.getElementById('hand-list');

            timelineSortable = new Sortable(timelineEl, { group: 'shared', animation: 150 });
            handSortable = new Sortable(handEl, { group: 'shared', animation: 150, sort: false });

            // Primera carta gratis
            const first = getRandomSong();
            timeline.push(first);
            renderTimeline();
            
            nextRound();
        }

        function nextRound() {
            currentSong = getRandomSong();
            if (!currentSong) return gameOver();

            // Poner carta en mano
            const handList = document.getElementById('hand-list');
            handList.innerHTML = createCardHTML(currentSong, false);

            // Reproducir
            if(player && player.loadVideoById) {
                player.loadVideoById({
                    videoId: currentSong.id,
                    startSeconds: currentSong.offset || 0
                });
            }
        }

        function checkAnswer() {
            const timelineEl = document.getElementById('timeline-list');
            const cards = Array.from(timelineEl.children);
            const userIndex = cards.findIndex(card => card.classList.contains('playing'));

            if (userIndex === -1) { alert("隆Arrastra la carta a la l铆nea de tiempo primero!"); return; }

            player.stopVideo();

            // L贸gica
            let prevYear = -Infinity;
            let nextYear = Infinity;
            if (userIndex > 0) prevYear = parseInt(cards[userIndex - 1].dataset.year);
            if (userIndex < cards.length - 1) nextYear = parseInt(cards[userIndex + 1].dataset.year);

            const actualYear = currentSong.year;
            const isCorrect = actualYear >= prevYear && actualYear <= nextYear;

            // UI Feedback
            const playedCard = cards[userIndex];
            playedCard.classList.remove('playing');
            playedCard.querySelector('.card-year').classList.remove('hidden-year');
            playedCard.querySelector('.card-year').innerText = actualYear;

            if (isCorrect) {
                playedCard.classList.add('correct');
                points++;
                document.getElementById('points').innerText = points;
                timeline.splice(userIndex, 0, currentSong); // Guardar en l贸gica
                setTimeout(() => { playedCard.classList.remove('correct'); nextRound(); }, 1000);
            } else {
                playedCard.classList.add('wrong');
                lives--;
                document.getElementById('lives').innerText = lives;
                alert(`隆Fallo! Era de ${actualYear}`);
                playedCard.remove(); // Quitar carta
                if (lives <= 0) gameOver();
                else nextRound();
            }
        }

        function getRandomSong() {
            if (allSongs.length === 0) return null;
            return allSongs.splice(Math.floor(Math.random() * allSongs.length), 1)[0];
        }

        function createCardHTML(song, revealed) {
            return `
                <div class="card ${!revealed ? 'playing' : ''}" data-year="${song.year}">
                    <div class="card-info">
                        <div class="card-title">${song.title}</div>
                        <div class="card-artist">${song.artist}</div>
                    </div>
                    <div class="card-year ${!revealed ? 'hidden-year' : ''}">${revealed ? song.year : '????'}</div>
                </div>
            `;
        }

        function renderTimeline() {
            document.getElementById('timeline-list').innerHTML = timeline.map(s => createCardHTML(s, true)).join('');
        }

        function replayAudio() { if(player) player.playVideo(); }
        function gameOver() {
            document.getElementById('game-over-modal').classList.remove('hidden');
            document.getElementById('final-score').innerText = points;
        }

    </script>
    <script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
